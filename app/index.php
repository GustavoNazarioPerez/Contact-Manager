<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<body>
    <!-- <video autoplay loop muted src="./assets/backround.mov" type="video/mov"></video> -->
    <header>

    </header>

    <main>
        <section id="hero">

            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='star'></div>
            <div class='title'>PhantonPhonebook</div>
            <div class='gravestones'>
                <div class='cross'></div>
                <div class='cross'></div>
                <div class='cross'></div>
            </div>
            <div class='bottompatch'>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
                <div class='patch'></div>
            </div>
            <div class='msg'>
                Dare to enter?
            </div>
            <div class='crypt'>
                <div class='roof'></div>
                <div class='body'>
                    <div class='door'></div>
                </div>
            </div>
            <div class='fog'></div>
            <div class='moon'></div>



            <!-- Log in Form -->
            <div class="center">
            </div>
            <div class="popup active">

                <form class="form" id="loginForm">
                    <h2>Log in</h2>
                    <div class="form-element">
                        <label for="username">Username</label>
                        <input type="text" id="logInusername" placeholder="Enter username" autocomplete="off">
                    </div>
                    <div class="form-element">
                        <label for="password">Password</label>
                        <input type="password" id="logInpassword" placeholder="Enter password" autocomplete="off">
                    </div>
                    <div id="loginError" class="error"></div>
                    <div class="form-element">
                        <button type="submit">Sign in</button>
                    </div>
                    <div class="switch-form">
                        Don't have an account? <br> <a href="#" id="showRegisterForm">Register now</a>
                    </div>

                </form>
            </div>

            <!-- Register Form -->
            <div class="center">
            </div>
            <div class="popup1 active">

                <form class="form" id="registrationForm">
                    <h2>Register</h2>
                    <div class="form-element">
                        <label for="username">Username</label>
                        <input type="text" id="username" placeholder="Enter username" autocomplete="off">
                    </div>
                    <div class="form-element">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Enter password" autocomplete="off">
                    </div>
                    <div id="registerError" class="error"></div>
                    <div class="form-element">
                        <button type="submit">Sign Up</button>
                    </div>
                    <div class="switch-form">
                        Already have an account? <a href="#" id="showLoginForm">Log in</a>
                    </div>

                </form>
            </div>
        </section>
    </main>


    <script>
        $(".patch").each((i) => {
            let b = i + 1
            let rX = Math.floor(Math.random() * 50)
            let rY = Math.floor(Math.random() * 100)
            let rH = Math.floor(Math.random() * 10) + 15
            $(".patch:nth-child(" + b + ")").css({
                left: i - 1 + "vw",
                height: rH + "vh",
                "-webkit-clip-path": "polygon(" + rX + "% " + rX + "%, 0% 100%, 100% 100%)",
                "clip-path": "polygon(" + rX + "% " + rX + "%, 0% 100%, 100% 100%)"
            })
        })

        $(".cross").each((i) => {
            let b = i + 1
            let rR = Math.floor(Math.random() * 15) * Math.cos(Math.PI * Math.round(Math.random()))
            $(".cross:nth-child(" + b + ")").css({
                "transform": "rotateZ(" + rR + "deg)"
            })
        })

        $(".star").each((i) => {
            $(".star:nth-child(" + i + ")").css({
                top: Math.random() * $(document).height() - $(document).height() / 4,
                left: Math.random() * $(document).width()
            })
        })

        init = () => {
            $(".crypt").css({
                "transform": "translateX(-50%) rotateZ(" + Math.floor(Math.random() * 5) * Math.cos(Math.PI * Math.round(Math.random())) + "deg)"
            })
            $(".title").animate({
                top: "45%"
            }, 5000, () => {
                $(".title").addClass("life")
                $(".msg").fadeIn(1000)
            })
        }

        init()
        document.addEventListener("DOMContentLoaded", function() {
            const loginForm = document.querySelector(".popup");
            const registerForm = document.querySelector(".popup1");

            // Show the login form by default on page load
            loginForm.style.display = "block";
            registerForm.style.display = "none";

            document.getElementById("showRegisterForm").addEventListener("click", function(e) {
                e.preventDefault();
                loginForm.style.display = "none";
                registerForm.style.display = "block";
            });

            document.getElementById("showLoginForm").addEventListener("click", function(e) {
                e.preventDefault();
                registerForm.style.display = "none";
                loginForm.style.display = "block";
            });
        });



        document.querySelector("#registrationForm").addEventListener("submit", function(event) {
            event.preventDefault();
            registerUser();
        });

        function registerUser() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            const data = {
                username: username,
                new_password: password,
                confirm_password: password
            };

            fetch('./LAMPAPI/RegisterUser.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.user_id) {
                        window.location.href = "home.php"; // Redirect to home.php
                    } else if (data.error) {
                        // Display the error message at the bottom of the form
                        displayError('register', data.error);
                    } else {
                        // General error for the whole form
                        alert('Login failed. Please try again.');
                    }
                })

        }

        document.querySelector("#loginForm").addEventListener("submit", function(event) {
            event.preventDefault();
            loginUser();
        });

        function loginUser() {
            const username = document.getElementById("logInusername").value;
            const password = document.getElementById("logInpassword").value;

            const data = {
                username: username,
                password: password
            };

            fetch('./LAMPAPI/LoginUser.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.user_id) {
                        window.location.href = "home.php"; // Redirect to home.php
                    } else if (data.error) {
                        // Display the error message at the bottom of the form
                        displayError('login', data.error);
                    } else {
                        // General error for the whole form
                        alert('Login failed. Please try again.');
                    }
                })

                .catch(error => {
                    console.error('Error during the login process:', error);
                });
        }

        function clearError(formType) {
            const errorElement = formType === 'login' ?
                document.getElementById("loginError") :
                document.getElementById("registerError");
            if (errorElement) {
                errorElement.textContent = '';
            }
        }


        function displayError(formType, message) {
            const errorElement = formType === 'login' ?
                document.getElementById("loginError") :
                document.getElementById("registerError");
            if (errorElement) {
                errorElement.textContent = message;
            }
        }
    </script>
</body>

</html>